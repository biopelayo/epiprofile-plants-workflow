# Snakefile for the EpiProfile_PLANTS workflow
# Main entry point — includes modular rule files for each pipeline stage.

configfile: "config/config_ontogeny_demo.yml"

# --- Include modular rules ------------------------------------------------
include: "rules/download.smk"
include: "rules/mzml.smk"
include: "rules/ms1_ms2.smk"

# --- Convenience targets ---------------------------------------------------
rule all:
    input:
        # 1. Download report
        os.path.join(config["base_dir"], "download_report.json"),
        # 2. Conversion manifest (raw → mzML)
        os.path.join(config["base_dir"], "conversion_manifest.json"),
        # 3. ms1/ms2 text extraction (mzML → .ms1 + .ms2 via xtract_xml)
        directory(os.path.join(config["base_dir"], config.get("ms1_dir", "MS1"))),
        directory(os.path.join(config["base_dir"], config.get("ms2_dir", "MS2"))),
        directory(os.path.join(config["base_dir"], "RawData")),


# Keep a simple smoke-test rule for CI / first-run validation
rule demo_touch:
    output:
        "docs/ONTOGENY_DEMO_OK.txt"
    run:
        with open(output[0], "w") as fh:
            fh.write(f"EpiProfile_PLANTS workflow demo run\n")
            fh.write(f"Project ID: {config.get('project_id', 'UNKNOWN')}\n")
            fh.write(f"Base dir:   {config.get('base_dir', 'NOT_DEFINED')}\n")
